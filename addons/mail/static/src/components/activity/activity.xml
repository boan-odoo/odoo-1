<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="mail.Activity" owl="1">
        <div class="o_Activity d-flex p-2" t-on-click="_onClick">
            <t t-if="activity">
                <div class="o_Activity_sidebar mr-3">
                    <div class="o_Activity_user position-relative mx-2">
                        <t t-if="activity.assignee">
                            <img class="o_Activity_userAvatar w-100 h-100 rounded-circle" t-attf-src="/web/image/res.users/{{ activity.assignee.id }}/avatar_128" t-att-alt="activity.assignee.nameOrDisplayName"/>
                        </t>
                        <div class="o_Activity_iconContainer w-100 h-100 rounded-circle d-flex align-items-center justify-content-center"
                            t-att-class="{
                                'bg-success': activity.state === 'planned',
                                'bg-warning': activity.state === 'today',
                                'bg-danger': activity.state === 'overdue',
                            }"
                        >
                            <i class="o_Activity_icon fa" t-attf-class="{{ activity.icon }}"/>
                        </div>
                    </div>
                </div>
                <div class="o_Activity_core">
                    <div class="o_Activity_info d-flex">
                        <b class="o_Activity_dueDateText"
                            t-att-class="{
                                'o-default': activity.state === 'default',
                                'o-overdue': activity.state === 'overdue',
                                'o-planned': activity.state === 'planned',
                                'o-today': activity.state === 'today',
                                'text-danger': activity.state === 'overdue',
                                'text-success': activity.state === 'planned',
                                'text-warning': activity.state === 'today',
                            }"
                        >
                            <t t-esc="delayLabel"/>
                        </b>
                        <t t-if="activity.summary">
                            <b class="o_Activity_summary text-900">
                                <t t-esc="summary"/>
                            </b>
                        </t>
                        <t t-elif="activity.type">
                            <b class="o_Activity_summary o_Activity_type text-900">
                                <t t-esc="activity.type.displayName"/>
                            </b>
                        </t>
                        <t t-if="activity.assignee">
                            <span class="o_Activity_userName">
                                <t t-esc="assignedUserText"/>
                            </span>
                        </t>
                        <span class="o_Activity_detailsButton py-0 px-1 ml-2 btn"
                            t-att-class="{'bg-100': state.areDetailsVisible}"
                            t-on-click="_onClickDetailsButton"
                            role="button">
                            <i class="fa" role="img" title="Info"
                                t-att-class="state.areDetailsVisible? 'fa-caret-down text-900' : 'fa-caret-left'"/>
                        </span>
                    </div>

                    <t t-if="state.areDetailsVisible">
                        <div class="o_Activity_details bg-100 p-2 mb-2">
                            <table class="table table-borderless table-sm m-0">
                                <tbody>
                                    <tr t-if="activity.type">
                                        <th scope="row" class="pr-3">Activity type</th>
                                        <td class="o_Activity_type" t-esc="activity.type.displayName"/>
                                    </tr>
                                    <tr t-if="activity.creator">
                                        <th scope="row" class="pr-3">Created</th>
                                        <td class="o_Activity_detailsCreation d-inline-flex">
                                            <t t-esc="formattedCreateDatetime"/>
                                            <div class="d-inline-flex">
                                                <img class="o_Activity_detailsUserAvatar rounded-circle o_Activity_detailsCreatorAvatar" t-attf-src="/web/image/res.users/{{ activity.creator.id }}/avatar_128" t-att-title="activity.creator.nameOrDisplayName" t-att-alt="activity.creator.nameOrDisplayName"/>
                                                <span class="o_Activity_detailsCreator">
                                                    <t t-esc="activity.creator.nameOrDisplayName"/>
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr t-if="activity.assignee">
                                        <th scope="row" class="pr-3">Assigned to</th>
                                        <td class="o_Activity_detailsAssignation d-inline-flex">
                                            <img class="o_Activity_detailsUserAvatar rounded-circle o_Activity_detailsAssignationUserAvatar" t-attf-src="/web/image/res.users/{{ activity.assignee.id }}/avatar_128" t-att-title="activity.assignee.nameOrDisplayName" t-att-alt="activity.assignee.nameOrDisplayName"/>
                                            <t t-esc="activity.assignee.nameOrDisplayName"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row" class="pr-3">Due on</th>
                                        <td class="o_Activity_detailsDueDate">
                                            <b class="o_Activity_deadlineDateText"
                                                t-att-class="{
                                                    'o-default': activity.state === 'default',
                                                    'o-overdue': activity.state === 'overdue',
                                                    'o-planned': activity.state === 'planned',
                                                    'o-today': activity.state === 'today',
                                                    'text-danger': activity.state === 'overdue',
                                                    'text-success': activity.state === 'planned',
                                                    'text-warning': activity.state === 'today',
                                                }">
                                                <t t-esc="formattedDeadlineDate"/>
                                            </b>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </t>

                    <t t-if="activity.note">
                        <div class="o_Activity_note">
                            <t t-raw="activity.note"/>
                        </div>
                    </t>

                    <t t-if="activity.mailTemplates.length > 0">
                        <div class="o_Activity_mailTemplates">
                            <t t-foreach="activity.mailTemplates" t-as="mailTemplate" t-key="mailTemplate.localId">
                                <MailTemplate
                                    class="o_Activity_mailTemplate"
                                    activityLocalId="activity.localId"
                                    mailTemplateLocalId="mailTemplate.localId"
                                />
                            </t>
                        </div>
                    </t>

                    <t t-if="activity.canWrite">
                        <div name="tools" class="o_Activity_tools d-flex">
                            <t t-if="activity.category !== 'upload_file'">
                                <Popover position="'right'" title="MARK_DONE">
                                    <button class="o_Activity_toolButton o_Activity_markDoneButton pt-0 btn btn-link text-success pl-0" t-att-title="MARK_DONE">
                                        <i class="fa fa-check"/> Mark Done
                                    </button>
                                    <t t-set="opened">
                                        <ActivityMarkDonePopover activityLocalId="props.activityLocalId"/>
                                    </t>
                                </Popover>
                            </t>
                            <t t-else="">
                                <button class="o_Activity_toolButton o_Activity_uploadButton pt-0 btn btn-link text-primary pl-0" t-on-click="_onClickUploadDocument">
                                    <i class="fa fa-upload"/> Upload Document
                                </button>
                                <FileUploader
                                    attachmentLocalIds="activity.attachments.map(attachment => attachment.localId)"
                                    uploadId="activity.thread.id"
                                    uploadModel="activity.thread.model"
                                    t-on-o-attachment-created="_onAttachmentCreated"
                                    t-ref="fileUploader"
                                />
                            </t>
                            <button class="o_Activity_toolButton o_Activity_editButton pt-0 btn btn-link text-primary" t-on-click="_onClickEdit">
                                <i class="fa fa-pencil"/> Edit
                            </button>
                            <button class="o_Activity_toolButton o_Activity_cancelButton pt-0 btn btn-link text-danger" t-on-click="_onClickCancel" >
                                <i class="fa fa-times"/> Cancel
                            </button>
                        </div>
                    </t>
                </div>
            </t>
        </div>
    </t>

</templates>
