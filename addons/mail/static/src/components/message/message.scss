// ------------------------------------------------------------------
// Layout
// ------------------------------------------------------------------

.o_Message_authorAvatar {
    object-fit: cover;
}

.o_Message_authorAvatarContainer {
    height: 36px;
    width: 36px;
}

.o_Message_Composer {
    flex: 1 1 auto;
}

.o_Message_content {
    word-wrap: break-word;
    word-break: break-word;

    *:not(li):not(li div) {
        // Message content can contain arbitrary HTML that might overflow and break
        // the style without this rule.
        // Lists are ignored because otherwise bullet style become hidden from overflow.
        // It's acceptable not to manage overflow of these tags for the moment.
        // It also excludes all div in li because 1st leaf and div child of list overflow
        // may impact the bullet point (at least it does on Safari).
        max-width: 100%;
        overflow-x: auto;
    }

    img {
        max-width: 100%;
        height: auto;
    }

    .o_Message_prettyBody > p:last-of-type {
        margin-bottom: 0;
    }

    .o_mention {
        cursor: pointer;
        @include o-hover-text-color($link-color, $link-hover-color);
    }
}

.o_Message_core {
    min-width: 0; // allows this flex child to shrink more than its content
    margin-inline-end: map-get($spacers, 4);
}

.o_Message_headerCommands,
.o_Message_headerDate,
.o_Message_originThread,
.o_Message_sidebar,
.o_Message_authorName,
.o_Message_moderationPending {
    margin-inline-end: map-get($spacers, 2);
}

.o_Message_partnerImStatusIcon {
    @include o-position-absolute($bottom: 0, $right: 0);
}

.o_Message_readMoreLess {
    display: block;
}

.o_Message_seenIndicator,
.o_Message_trackingValueItem,
.o_Message_date {
    margin-inline-end: map-get($spacers, 1);
}

.o_Message_sidebar {
    width: $o-mail-message-sidebar-width;
}

// ------------------------------------------------------------------
// Style
// ------------------------------------------------------------------

.o_Message_command, .o_Message_sidebarItem.o-message-squashed {
    opacity: 0;

    .o_Message:hover &, &.visible {
        opacity: 1;
    }
}

.o_Message_commandStar {
    @include o-hover-text-color($o-main-text-color, $o-main-favorite-color);
    &:hover:before {content: "\f005"}

    &.o-message-starred {
        @include o-hover-text-color($o-main-favorite-color, $o-main-text-color);
        &:hover:before {content: "\f006"}
    }
}

.o_Message_partnerImStatusIcon {
    color: $o-view-background-color;

    &:not(.o_Message_partnerImStatusIcon-mobile) {
        font-size: x-small;
    }
}

.o_Message {
    &.o-not-discussion {
        + .o-not-discussion {
            margin-top: 2px;
        }

        .o_Message_partnerImStatusIcon {
            color: gray('100');
        }

        &.o-selected {
            border-bottom: 1px solid gray('300');
        }
    }

    &.o-selected {
        margin-bottom: map-get($spacers, 2);
        border-width: 1px 0 !important;
        background-color: mix(theme-color('info'), $o-view-background-color, 4%);

        .o_Message_partnerImStatusIcon {
            color: mix(theme-color('info'), $o-view-background-color, 4%);
        }
    }

    &.o-has-message-selection {
        transition: all .2s ease-out;

        + .o-selected {
            margin-top: map-get($spacers, 2);
        }

        &:not(.o-selected) {
            transform: scale(.95);
            transform-origin: left;
            opacity: 0.7;
        }
    }

    &.o-highlighted {
        background-color: mix($o-brand-primary, $o-view-background-color, 10%);

        .o_Message_partnerImStatusIcon {
            color: mix($o-brand-primary, $o-view-background-color, 10%);
        }
    }
}

.o_Message_authorRedirect, .o_Message_notificationIconClickable {
    cursor: pointer;
}

// Used to hide buttons on rating emails in chatter
// FIXME: should use a better approach for not having such buttons
// in chatter of such messages, but keep having them in emails.
.o_Message_content [summary~="o_mail_notification"] {
    display: none;
}
